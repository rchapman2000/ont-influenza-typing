# Nextflow ONT Influenza Typing Pipeline
A nextflow pipeline built to type influenza sequencing data. The pipeline was inspired by the [INSaFLU Database](https://insaflu.insa.pt/) and the [wf-flu pipeline](https://github.com/epi2me-labs/wf-flu) from EPI2ME Labs. Both of these tools require a connection to the internet, which is not possible in many cases. Thus, this pipeline is a quick alternative that can be run locally.

The pipeline processes/filters reads, performs a *de novo* assembly using [Miniasm](https://github.com/lh3/miniasm), polishes reads using [Racon](https://github.com/isovic/racon) and [Medaka](https://github.com/nanoporetech/medaka), and finally types the contigs generated by alignining them against the INSaFLU typing database using [Abricate](https://github.com/tseemann/abricate).

## Installation

To install the pipeline, enter the following commands:
```
# Clone the repository
git clone https://github.com/rchapman2000/ont-influenza-typing

# Create a conda environment using the provided environment.yml file
conda env create -f environment.yml

# Activate the conda environment
conda activate ONT-Flu-Typing
```

### Updating the Pipeline
If you already have the pipeline installed, you can update it using the following commands:
```
# Navigate to your installation directory
cd ont-influenza-typing

# Use git pull to get the latest update
git pull

# Activate the conda environment and use the environment.yml file to download updates
conda activate ONT-Flu-Typing
conda env update --file environment.yml --prune
```

## Usage
To run the pipeline, use the following command:
```
# You must either be in the same directory as the main.nf file or reference the file location.
nextflow run main.nf [options] --input INPUT_DIR --output OUTPUT_DIR --model MEDAKA_MODEL
```

### Options
The pipeline also supports the following optional arguments:

| Option | Type | Description |
|---|---|---|
| --trimONTAdapters | *None* | Enables ONT Adapter/Barcodee trimming using Porechop [Default = OFF] |
| --minReadLen | *INT* | If supplied, the pipeline will perform length filtering using Chopper excluding reads less than this size and sets the minimum length for Miniasm assembly [Default = 200 bp] |
| --maxReadLen | *INT* | If supplied, the pipeline will perform legnth filtering using Chopper excluding reads greater than this size [Default = off]  |
| --localAlignment | *INT* | The minimum size of an overlaps to be used in Miniasm assembly [Default = 15 bp]|
| --threads | *INT* | The number of threads that can be use to run pipeline tools in parallel. [Default = 1] |

To view the list of options from the command line, use the following command:
```
nextflow run main.nf --help
```
